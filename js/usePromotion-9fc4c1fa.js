import{r as o,aN as H,P as _,w,Y as P,aF as m,aG as b,e as $,aE as E,W as x,X as L}from"./vendor-749afd36.js";import{g as R,a as A}from"./promotion-a70e8dd5.js";import{a as G,c as M,ao as J,ap as U,t as Y,i as z,S as F,e as W}from"./index-42c4f717.js";const ta=({perPage:i,isMobile:I=!1,elements:D,paginationMode:p="normal"})=>{const e=x(),n=L(),r=G(),l=o(!1),a=o([]),v=o(!1),u=M(),d=o(""),h=o(),V=o(p),g=H({promotionId:"",name:"",promotionBanner:""}),B=J(),{selectedTab:c}=B,{setCurrentPage:S,currentPage:f,totalPage:O,setTotalCount:T}=U({list:a,pageSize:i},{count:0});_(async()=>{await N({page:f.value}),e.params.id&&y()}),w(()=>a.value,()=>{if(e.params.id){const t=P(m(b(a.value),"items"),["PromotionId",parseInt(e.params.id.toString())]);I||C(!0,t);return}});const y=()=>{h.value=P(m(a.value[c.value],"items"),["PromotionId",parseInt(e.params.id.toString())])};w(()=>e.params.id,()=>{e.params.id&&(d.value=m(P(m(a.value[c.value],"items"),["PromotionId",parseInt(e.params.id.toString())]),"Name"),y())}),w(f,()=>{D?.value.scrollIntoView()});async function N({page:t}){l.value=!0,r.setPageLoading(!0);try{const s=await R();S(t),a.value=JSON.parse(s.Data.toString()),b(a.value)&&r.setPromotionList(b(a.value).items),T(a.value[f.value-1]?.items.length??1)}finally{l.value=!1,r.setPageLoading(!1)}}const k=$(()=>{if(!a.value[c.value])return[];const t=a.value[c.value].items,s=(f.value-1)*i;switch(V.value){case"normal":return E(t,s,s+i);case"samePage":return E(t,0,s+i)}}),C=(t,s)=>{v.value=t,t?(g.promotionId=s.PromotionId,g.name=s.Name,s.PromotionBanner?g.promotionBanner=Y({target:"CdnRedirect2",srcPath:`${s.PromotionBanner}`}):g.promotionBanner=""):e.params.id&&n.push("/Promotion")};return{changeModal:C,onTabInitChange:()=>{a.value[c.value]&&(S(1),e.params.id&&n.push({path:"/Promotion"}),T(a.value[c.value].items.length))},currentItems:k,currentPage:f,detailData:h,fetchList:N,goBack:()=>{n.push("/Promotion")},listData:a,loading:l,modalData:g,setCurrentPage:S,setTotalCount:T,showDetail:t=>{u.setHeaderVisible(!u.headerVisible),n.push({path:`/Promotion/${t}`})},showDetailPage:t=>{n.push({path:`/Promotion/${t}`})},showModal:v,title:d,totalPage:O,useTab:B}},ea=i=>{const I=M(),D=L(),p=o(!1),e=o(),n=o([]),r=o(""),l=o();async function a({id:u}){I.setHeaderVisible(!1),p.value=!0;try{if(r.value=i.value,z(i.value)||F.THEME_LAYOUT_CODE=="a03"){const h=await R();n.value=JSON.parse(h.Data.toString()),r.value=m(P(n.value[0].items,["PromotionId",parseInt(u)]),"Name"),l.value=m(P(n.value[0].items,["PromotionId",parseInt(u)]),"BeginTime")}const d=await A({promotionId:u});if(W(d?.Data))return v();e.value=d.Data}finally{p.value=!1}}const v=()=>{D.push("/Promotion")};return{detail:e,fetchDetail:a,goBack:v,loading:p,titleName:r,titleTime:l}};export{ea as a,ta as u};
